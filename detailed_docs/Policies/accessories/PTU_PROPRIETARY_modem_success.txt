-- Policy Update Sequence
title Policy Table Update with in-vehicle modem - Success flow

participant SDL
participant HMI
participant Modem
participant Policy Server

note over SDL: PT update is required

SDL->HMI: SDL.OnStatusUpdate(UPDATE_NEEDED)
SDL->SDL: Creates PTSnapshot
SDL->HMI: BC.PolicyUpdate(fileLocation,timeout,retry)
HMI-->SDL: SUCCESS: BC.PolicyUpdate()
SDL->HMI:OnStatusUpdate(UPDATING)
SDL->SDL: Starts timeout taken from "timeout_after_x_seconds" of Local PT
note over HMI:Requests the urls to send PTSnapshot
HMI->SDL: SDL.GetPolicyConfigurationData\n("policy_type=module_config", "property=endpoints")
note over SDL: Gets endpoints from policies database
SDL-->HMI: SDL.GetPolicyConfigurationData("endpoints":{"0x07":{...})
HMI->HMI: PT snapshot\nencryption
note over HMI: Sends encrypted PTS file to the defined URL
HMI-> Modem: Use vehicle modem to send PTS to URL
HMI->HMI: Starts PTU timer
Modem -> Policy Server: Sending PTS over cellular
note over Policy Server: Processes PTS and creates PTU
Policy Server-->Modem: Sending PTU over cellular
Modem --> HMI: Transport PTU back to HMI
note over HMI: Decrypts PTU,\nnotifies SDL about\ndecrypted PTU
HMI->HMI: Decrypts PTU()
HMI->SDL: SDL.OnReceivedPolicyUpdate(<policyFile>)
SDL->SDL:Stops timeout
note over SDL: Checks if PTU is correct
SDL->HMI: SDL.OnStatusUpdate(UP_TO_DATE)
